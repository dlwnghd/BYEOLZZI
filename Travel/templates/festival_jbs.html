{%load static%}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>festival_info</title>
    <script
        src="https://apis.openapi.sk.com/tmap/vectorjs?version=1&appKey=l7xx7984c4fb128445d99596ea8b0d4584d1"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
</head>

<body>
    <h2>
        축제 정보
    </h2>
    <body onload="initTmap()"><!-- 맵 생성 실행 -->
        <div id="map_div"></div>
    </body>
    
    {% for i in data %}

        <table>
            <tbody>
                <tr>
                    <td rowspan="4">
                        <img src={{i.image}} style="width:100px; height:100px;">
                    </td>
                    <td>
                        축제명
                    </td>
                    <td>
                        <p class="title">{{i.title}}</p>
                    </td>
                </tr>
                <tr>
                    <td>
                        시작일
                    </td>
                    <td>
                        {{i.startDate}}
                    </td>
                </tr>
                <tr>
                    <td>
                        종료일
                    </td>
                    <td>
                        {{i.endDate}}
                    </td>
                </tr>
                <tr>
                    <td>
                        주소
                    </td>
                    <td>
                        {{i.addr1}}
                    </td>
                </tr>
                <tr>
                    <td lowspan="2">
                        <div id="map_div"></div>
                    </td>
                </tr>
            </tbody>
        </table>
        <p class="mapx" style="display: none;">{{i.mapx}}</p>
        <p class="mapy" style="display: none;">{{i.mapy}}</p>
        <br><br>
    {% endfor %}
        <script type="text/javascript">

        var map;
        // 페이지가 로딩이 된 후 호출하는 함수입니다.
        function initTmap(){
            // map 생성
            // Tmapv3.Map을 이용하여, 지도가 들어갈 div, 넓이, 높이를 설정합니다.
            var xmap=document.getElementsByClassName("mapx")
            var ymap=document.getElementsByClassName("mapy")
            var title_name = document.getElementsByClassName('title')
            console.log("x좌표",xmap[0].innerHTML)
            console.log("y좌표",ymap[0].innerHTML)
            console.log("title :", title_name[0].innerHTML)
            console.log("x좌표",typeof(xmap[0].innerHTML))
            if (xmap[1].innerHTML){
            console.log("x좌표",xmap[1].innerHTML)
            console.log("y좌표",ymap[1].innerHTML)
            console.log("title :", title_name[1].innerHTML)
            } 

            map = new Tmapv3.Map("map_div", {
                center : new Tmapv3.LatLng((parseFloat(ymap[0].innerHTML)+parseFloat(ymap[1].innerHTML))/2,(parseFloat(xmap[0].innerHTML)+parseFloat(xmap[1].innerHTML))/2),
                width : "100%",	// 지도의 넓이
                height : "400px",	// 지도의 높이
                zoom : 9	// 지도 줌레벨
            });
            
            // Marker 객체 생성.
            if (xmap[0].innerHTML){
            var marker0 = new Tmapv3.Marker({
                position: new Tmapv3.LatLng(parseFloat(ymap[0].innerHTML),parseFloat(xmap[0].innerHTML)),	//Marker의 중심좌표 설정.
                icon :"/static/images/marker/pin.png",
                map: map,	//Marker가 표시될 Map 설정..
            });

            marker0.on("Click", function(evt) {
                var content = "<div id='content_marker0' style=' position: relative; border-bottom: 1px solid #dcdcdc; line-height: 18px; padding: 0 35px 2px 0;'>"
                + "<div style='font-size: 12px; line-height: 15px;'>"
                + "<span style='display: inline-block; width: 14px; height: 14px; background-image: url(/resources/images/common/icon_blet.png); vertical-align: middle; margin-right: 5px;'></span>"+title_name[0].innerHTML
                + "</div>" + "</div>";

                infoWindow = new Tmapv3.InfoWindow({
                position: new Tmapv3.LatLng(parseFloat(ymap[0].innerHTML)-0.0006,parseFloat(xmap[0].innerHTML)), //Popup 이 표출될 맵 좌표
                content: content, //Popup 표시될 text
                type: 2, //Popup의 type 설정.
                map: map //Popup이 표시될 맵 객체
            });
                })
            
            map.setCenter(new Tmapv3.LatLng(parseFloat(ymap[0].innerHTML),parseFloat(xmap[0].innerHTML)));
            }

		//Popup 객체 생성.


            


            if (xmap[1].innerHTML){
            var marker1 = new Tmapv3.Marker({
                position: new Tmapv3.LatLng(parseFloat(ymap[1].innerHTML),parseFloat(xmap[1].innerHTML)),
                icon :"/static/images/marker/pin.png",	//Marker의 중심좌표 설정.
                map: map	//Marker가 표시될 Map 설정..
            });


            marker1.on("Click", function(evt) {
                var content = "<div id='content_marker0' style=' position: relative; border-bottom: 1px solid #dcdcdc; line-height: 18px; padding: 0 35px 2px 0;'>"
                + "<div style='font-size: 12px; line-height: 15px;'>"
                + "<span style='display: inline-block; width: 14px; height: 14px; background-image: url(/resources/images/common/icon_blet.png); vertical-align: middle; margin-right: 5px;'></span>"+title_name[1].innerHTML
                + "</div>" + "</div>";

                infoWindow = new Tmapv3.InfoWindow({
                position: new Tmapv3.LatLng(parseFloat(ymap[1].innerHTML)-0.0006,parseFloat(xmap[1].innerHTML)), //Popup 이 표출될 맵 좌표
                content: content, //Popup 표시될 text
                type: 2, //Popup의 type 설정.
                map: map //Popup이 표시될 맵 객체
            });
                })

            map.setCenter(new Tmapv3.LatLng(parseFloat(ymap[1].innerHTML),parseFloat(xmap[1].innerHTML)));
        
        
        }


            if (xmap[2].innerHTML){
            var marker2 = new Tmapv3.Marker({
                position: new Tmapv3.LatLng(parseFloat(ymap[2].innerHTML-0.0006),parseFloat(xmap[2].innerHTML)),	//Marker의 중심좌표 설정.
                icon :"/static/images/marker/pin.png",
                map: map	//Marker가 표시될 Map 설정..
            });
            marker2.on("Click", function(evt) {
                var content = "<div id='content_marker0' style=' position: relative; border-bottom: 1px solid #dcdcdc; line-height: 18px; padding: 0 35px 2px 0;'>"
                + "<div style='font-size: 12px; line-height: 15px;'>"
                + "<span style='display: inline-block; width: 14px; height: 14px; background-image: url(/resources/images/common/icon_blet.png); vertical-align: middle; margin-right: 5px;'></span>"+title_name[2].innerHTML
                + "</div>" + "</div>";

                infoWindow = new Tmapv3.InfoWindow({
                position: new Tmapv3.LatLng(parseFloat(ymap[2].innerHTML)-0.0006,parseFloat(xmap[2].innerHTML)), //Popup 이 표출될 맵 좌표
                content: content, //Popup 표시될 text
                type: 2, //Popup의 type 설정.
                map: map //Popup이 표시될 맵 객체
            });
                })
            map.setCenter(new Tmapv3.LatLng(parseFloat(ymap[2].innerHTML),parseFloat(xmap[2].innerHTML)));
        }

            if (xmap[3].innerHTML){
            var marker3 = new Tmapv3.Marker({
                position: new Tmapv3.LatLng(parseFloat(ymap[3].innerHTML-0.0006),parseFloat(xmap[3].innerHTML)),	//Marker의 중심좌표 설정.
                icon :"/static/images/marker/pin.png",
                map: map	//Marker가 표시될 Map 설정..
            });
            marker3.on("Click", function(evt) {
                var content = "<div id='content_marker0' style=' position: relative; border-bottom: 1px solid #dcdcdc; line-height: 18px; padding: 0 35px 2px 0;'>"
                + "<div style='font-size: 12px; line-height: 15px;'>"
                + "<span style='display: inline-block; width: 14px; height: 14px; background-image: url(/resources/images/common/icon_blet.png); vertical-align: middle; margin-right: 5px;'></span>"+title_name[3].innerHTML
                + "</div>" + "</div>";

                infoWindow = new Tmapv3.InfoWindow({
                position: new Tmapv3.LatLng(parseFloat(ymap[3].innerHTML)-0.0006,parseFloat(xmap[3].innerHTML)), //Popup 이 표출될 맵 좌표
                content: content, //Popup 표시될 text
                type: 2, //Popup의 type 설정.
                map: map //Popup이 표시될 맵 객체
            });
                })
            map.setCenter(new Tmapv3.LatLng(parseFloat(ymap[3].innerHTML),parseFloat(xmap[3].innerHTML)));
        }

            if (xmap[4].innerHTML){
            var marker4 = new Tmapv3.Marker({
                position: new Tmapv3.LatLng(parseFloat(ymap[4].innerHTML-0.0006),parseFloat(xmap[4].innerHTML)),	//Marker의 중심좌표 설정.
                icon :"/static/images/marker/pin.png",
                map: map	//Marker가 표시될 Map 설정..
            });
            marker4.on("Click", function(evt) {
                var content = "<div id='content_marker0' style=' position: relative; border-bottom: 1px solid #dcdcdc; line-height: 18px; padding: 0 35px 2px 0;'>"
                + "<div style='font-size: 12px; line-height: 15px;'>"
                + "<span style='display: inline-block; width: 14px; height: 14px; background-image: url(/resources/images/common/icon_blet.png); vertical-align: middle; margin-right: 5px;'></span>"+title_name[4].innerHTML
                + "</div>" + "</div>";

                infoWindow = new Tmapv3.InfoWindow({
                position: new Tmapv3.LatLng(parseFloat(ymap[4].innerHTML)-0.0006,parseFloat(xmap[4].innerHTML)), //Popup 이 표출될 맵 좌표
                content: content, //Popup 표시될 text
                type: 2, //Popup의 type 설정.
                map: map //Popup이 표시될 맵 객체
            });
                })
            map.setCenter(new Tmapv3.LatLng(parseFloat(ymap[4].innerHTML),parseFloat(xmap[4].innerHTML)));
        }



            // //Marker 객체 생성.
            // var marker = new Tmapv3.Marker({
            //     position: new Tmapv3.LatLng(37.56520450, 126.98802028),	//Marker의 중심좌표 설정.
            //     map: map	//Marker가 표시될 Map 설정..
            // });
        }

        //Marker 객체 생성.

        // var xmap=document.getElementsByClassName("mapx").innerText
        // var ymap=document.getElementsByClassName("mapy").innerText
        // console.log("x좌표",xmap[0])
        // console.log("y좌표",ymap[0])
        // var marker = new Tmapv3.Marker({
        //     // position: new Tmapv3.LatLng(parseFloat(xmap[0]), parseFloat(ymap[0])),	//Marker의 중심좌표 설정.
        //     position: new Tmapv3.LatLng(128.8701379764, 37.7707215201),	//Marker의 중심좌표 설정.
        //     map: map	//Marker가 표시될 Map 설정..
        // });
        </script>
        
</body>
</html>
